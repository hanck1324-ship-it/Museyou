# Phase 5: 전체 통합 테스트 & 코드 품질 최종 검증

모든 개별 기능 테스트가 완료되면 전체 시스템을 통합 테스트하고 코드 품질을 최종 검증합니다.

---

## 1. 코드 품질 최종 점검

### DRY 원칙 (Don't Repeat Yourself)

#### 중복 코드 찾기
```bash
# 파일 간 유사도 검사
find src -name "*.tsx" -o -name "*.ts" | xargs -I {} wc -l {} | sort -nr | head -20

# 중복 코드 패턴 찾기
grep -r "useEffect" src/ | wc -l
grep -r "useState" src/ | wc -l
```

#### 체크리스트
- [ ] **3번 이상 반복되는 코드 없는가?**
  - 예: 동일한 API 호출 로직
  - 예: 동일한 폼 검증 로직
  - 예: 동일한 에러 처리 로직

- [ ] **공통 함수로 추출 가능한 로직 없는가?**
  ```typescript
  // ❌ Bad: 중복
  // PerformanceCard.tsx
  const url = image?.startsWith('http') ? image : getStorageUrl(image);
  
  // UserProfile.tsx
  const url = avatar?.startsWith('http') ? avatar : getStorageUrl(avatar);
  
  // ✅ Good: 공통 함수
  // utils/storage.ts
  export const getImageUrl = (path: string | null, fallback = '/placeholder.jpg') => {
    if (!path) return fallback;
    return path.startsWith('http') ? path : getStorageUrl(path);
  };
  ```

- [ ] **재사용 가능한 컴포넌트로 분리되었는가?**

---

### TypeScript any 금지

#### 자동 검사
```bash
# any 타입 사용 찾기
grep -rn "as any" src/
grep -rn ": any" src/
grep -rn "<any>" src/

# 결과: 0건이어야 함!
```

#### 수동 점검
- [ ] **모든 함수에 반환 타입이 명시되었는가?**
  ```typescript
  // ❌ Bad
  function fetchData() {
    return supabase.from('performances').select('*');
  }
  
  // ✅ Good
  function fetchData(): Promise<Performance[]> {
    return supabase.from('performances').select('*');
  }
  ```

- [ ] **모든 Props에 타입이 정의되었는가?**
  ```typescript
  // ❌ Bad
  function PerformanceCard({ performance, onLike }) {
  
  // ✅ Good
  interface PerformanceCardProps {
    performance: Performance;
    onLike: (id: string) => void;
  }
  function PerformanceCard({ performance, onLike }: PerformanceCardProps) {
  ```

- [ ] **API 응답에 타입이 정의되었는가?**
  ```typescript
  // ✅ Good
  interface ApiResponse<T> {
    data: T | null;
    error: Error | null;
  }
  
  const response: ApiResponse<Performance[]> = await fetchPerformances();
  ```

---

### 컴포넌트 설계 원칙

#### Single Responsibility Principle
- [ ] **각 컴포넌트가 하나의 역할만 하는가?**
- [ ] **파일 길이가 300줄 이하인가?**
  ```bash
  # 300줄 넘는 파일 찾기
  find src -name "*.tsx" -exec wc -l {} \; | awk '$1 > 300 {print $2, $1}'
  ```

- [ ] **복잡한 로직이 커스텀 훅으로 분리되었는가?**

#### 컴포넌트 분리 체크
```typescript
// ❌ Bad: 하나의 거대한 컴포넌트 (500줄)
function PerformancePage() {
  // 공연 정보, 리뷰, 좋아요, 공유 등 모든 로직
}

// ✅ Good: 역할별 분리
function PerformancePage() {
  return (
    <>
      <PerformanceInfo />
      <PerformanceActions />
      <ReviewSection />
      <RelatedPerformances />
    </>
  );
}
```

---

### 에러 처리 패턴

#### 모든 API 호출에 에러 처리
```bash
# try-catch 없는 async 함수 찾기
grep -rn "async function" src/ | grep -v "try"
```

- [ ] **모든 Supabase 쿼리에 에러 처리가 있는가?**
  ```typescript
  // ✅ Good
  const { data, error } = await supabase.from('performances').select('*');
  if (error) {
    console.error('Error:', error);
    toast.error('데이터를 불러올 수 없습니다');
    return;
  }
  ```

- [ ] **사용자 친화적인 에러 메시지가 표시되는가?**

---

### 성능 최적화

#### React.memo 적용
- [ ] **Props가 자주 변경되지 않는 컴포넌트에 memo 적용**
  ```typescript
  export const PerformanceCard = React.memo(PerformanceCardComponent);
  ```

#### useMemo/useCallback 적용
- [ ] **무거운 계산에 useMemo 적용**
- [ ] **Props로 전달되는 함수에 useCallback 적용**

#### 이미지 최적화
- [ ] **모든 이미지에 lazy loading 적용**
  ```tsx
  <img loading="lazy" src={imageUrl} alt={title} />
  ```

---

## 2. 전체 시스템 통합 테스트

### 사용자 시나리오 테스트

#### Scenario 1: 신규 회원 가입 → 공연 예매
```
1. 회원가입 페이지 접속
2. 정보 입력 및 회원가입
3. 자동 로그인 확인
4. 홈 페이지 이동
5. 공연 목록 보기
6. 공연 상세 페이지 이동
7. 리뷰 작성
8. 좋아요 클릭
```

**체크리스트:**
- [ ] 모든 단계가 정상 동작
- [ ] 페이지 전환이 부드러움
- [ ] 데이터가 정확히 저장됨
- [ ] 에러 없이 완료

#### Scenario 2: 로그인 → 매칭 신청
```
1. 로그인 페이지 접속
2. 로그인
3. 매칭 페이지 이동
4. 매칭 카드 목록 보기
5. 필터 적용
6. 매칭 신청
7. 신청 내역 확인
```

**체크리스트:**
- [ ] 로그인 후 리다이렉트 정상
- [ ] 매칭 목록 정상 로드
- [ ] 필터링 동작
- [ ] 매칭 신청 성공

#### Scenario 3: 게시글 작성 → 수정 → 삭제
```
1. 로그인
2. 게시판 이동
3. 글쓰기 클릭
4. 게시글 작성 (이미지 포함)
5. 작성 완료
6. 상세 페이지 확인
7. 수정 버튼 클릭
8. 내용 수정
9. 수정 완료
10. 삭제 버튼 클릭
11. 확인 모달
12. 삭제 완료
```

**체크리스트:**
- [ ] 모든 CRUD 동작 정상
- [ ] 이미지 업로드 성공
- [ ] 권한 체크 동작
- [ ] 삭제 후 목록 이동

---

### 크로스 브라우저 테스트

| 브라우저 | 버전 | 테스트 결과 | 이슈 |
|---------|------|------------|------|
| Chrome | Latest | [ ] 통과 | |
| Safari | Latest | [ ] 통과 | |
| Firefox | Latest | [ ] 통과 | |
| Edge | Latest | [ ] 통과 | |
| Mobile Safari | iOS 15+ | [ ] 통과 | |
| Mobile Chrome | Android | [ ] 통과 | |

---

### 반응형 테스트

#### 모바일 (< 768px)
- [ ] 하단 네비게이션 표시
- [ ] 카드 1열 배치
- [ ] 햄버거 메뉴 동작
- [ ] 터치 영역 크기 (48px 이상)
- [ ] 스와이프 제스처 (있다면)

#### 태블릿 (768px - 1024px)
- [ ] 카드 2열 배치
- [ ] 사이드바 토글 동작
- [ ] 터치/마우스 모두 지원

#### 데스크톱 (> 1024px)
- [ ] 카드 3-4열 배치
- [ ] 사이드바 고정
- [ ] 호버 효과 동작
- [ ] 키보드 단축키 (있다면)

---

### 접근성 (a11y) 테스트

#### 자동화 도구
```bash
# Lighthouse 실행
Chrome DevTools > Lighthouse > Accessibility

# 목표: 90점 이상
```

#### 수동 테스트
- [ ] **키보드만으로 전체 사이트 탐색 가능**
  - Tab: 다음 요소
  - Shift + Tab: 이전 요소
  - Enter/Space: 버튼 클릭
  - Esc: 모달 닫기

- [ ] **스크린 리더 테스트** (VoiceOver/NVDA)
  - 모든 이미지에 alt 텍스트
  - 모든 버튼에 aria-label
  - 폼 필드에 label 연결

- [ ] **색상 대비 WCAG AA 준수**
  - 텍스트: 4.5:1
  - 큰 텍스트: 3:1

---

### 성능 테스트

#### Lighthouse Performance
```bash
# 목표 점수
- Performance: > 90
- First Contentful Paint: < 1.8s
- Largest Contentful Paint: < 2.5s
- Time to Interactive: < 3.8s
- Cumulative Layout Shift: < 0.1
```

#### 번들 분석
```bash
npm run build

# 체크 항목
- [ ] 총 번들 크기 < 500KB (gzipped)
- [ ] 가장 큰 청크 < 200KB
- [ ] 코드 스플리팅 적용
- [ ] Tree shaking 동작
```

#### 네트워크 분석
- [ ] API 호출 수 최소화
- [ ] 이미지 최적화 (WebP, lazy loading)
- [ ] 중복 요청 방지
- [ ] 캐싱 전략 적용

---

## 3. 빌드 & 배포 준비

### 빌드 테스트
```bash
# 1. 린트 체크
npm run lint
# 결과: 에러 0개, 경고 최소화

# 2. TypeScript 타입 체크
npx tsc --noEmit
# 결과: 에러 0개

# 3. 빌드
npm run build
# 결과: 빌드 성공

# 4. 프로덕션 서버 실행 (로컬)
npm run preview
# 결과: 정상 동작 확인
```

### 환경 변수 체크
```bash
# .env 파일 확인
- [ ] VITE_SUPABASE_URL
- [ ] VITE_SUPABASE_ANON_KEY
- [ ] 기타 필요한 환경 변수

# .env.example 파일 생성 (민감 정보 제외)
```

### 빌드 산출물 확인
```
dist/
├── index.html
├── assets/
│   ├── index-[hash].js
│   ├── index-[hash].css
│   └── [images]
└── favicon.ico

# 체크
- [ ] HTML 파일 생성
- [ ] JS/CSS 번들 생성
- [ ] 이미지 파일 복사
- [ ] Source map 생성 (개발용)
```

---

## 4. 보안 체크리스트

### 인증/인가
- [ ] 비밀번호 평문 저장 안 함 (Supabase 관리)
- [ ] JWT 토큰 만료 처리
- [ ] 보호된 페이지 인증 체크
- [ ] 권한 체크 (본인만 수정/삭제)

### XSS 방어
- [ ] 사용자 입력 이스케이프
- [ ] dangerouslySetInnerHTML 사용 안 함
- [ ] CSP 헤더 설정

### Supabase RLS (Row Level Security)
- [ ] 테이블별 RLS 정책 설정
- [ ] 본인 데이터만 수정/삭제 가능
- [ ] 공개 데이터는 모두 읽기 가능

---

## 5. 문서화 최종 점검

### README.md
- [ ] 프로젝트 소개
- [ ] 기술 스택
- [ ] 시작 가이드
- [ ] 환경 변수 설정
- [ ] 배포 방법

### 코드 주석
- [ ] 복잡한 로직에 주석
- [ ] "왜"를 설명하는 주석
- [ ] TODO 주석 정리

### API 문서
- [ ] Supabase 테이블 스키마
- [ ] API 엔드포인트
- [ ] 요청/응답 예시

---

## 6. Git 최종 점검

### 커밋 히스토리
```bash
# 최근 커밋 확인
git log --oneline -10

# 체크
- [ ] 커밋 메시지가 명확한가?
- [ ] Conventional Commits 준수했는가?
- [ ] 불필요한 커밋 없는가?
```

### .gitignore
```bash
# 체크 항목
- [ ] node_modules/
- [ ] .env (민감 정보)
- [ ] dist/
- [ ] .DS_Store
- [ ] *.log
```

### Git Hooks
```bash
# pre-commit 훅 설정 (husky)
- [ ] 커밋 전 lint 실행
- [ ] 커밋 전 타입 체크
- [ ] 커밋 메시지 검증
```

---

## 7. 최종 체크리스트

### 필수 항목 ✅
- [ ] **모든 기능 테스트 통과**
- [ ] **ESLint 에러 0개**
- [ ] **TypeScript 에러 0개**
- [ ] **any 타입 사용 0건**
- [ ] **중복 코드 최소화**
- [ ] **npm run build 성공**
- [ ] **반응형 동작 (모바일/태블릿/데스크톱)**
- [ ] **주요 브라우저 호환**

### 권장 항목 ⭐
- [ ] Lighthouse Performance > 90점
- [ ] Lighthouse Accessibility > 90점
- [ ] 번들 크기 < 500KB
- [ ] 접근성 테스트 통과
- [ ] 보안 체크리스트 완료

### 문서화 📝
- [ ] README.md 최신 상태
- [ ] 주요 컴포넌트 prompts 작성
- [ ] 코드 주석 추가
- [ ] API 문서 작성

---

## 8. 배포 전 최종 확인

### 로컬 환경
```bash
# 1. 클린 빌드
rm -rf node_modules dist
npm install
npm run build

# 2. 프로덕션 모드 실행
npm run preview

# 3. 모든 기능 재테스트
```

### 체크리스트
- [ ] 프로덕션 빌드 성공
- [ ] 프로덕션 모드에서 동작 확인
- [ ] 환경 변수 정확히 설정
- [ ] 에러 모니터링 설정 (Sentry 등)

---

## 9. 배포 후 모니터링

### 초기 모니터링 (배포 후 24시간)
- [ ] 에러 로그 확인
- [ ] 사용자 피드백 수집
- [ ] 성능 메트릭 확인
- [ ] 트래픽 모니터링

### 지속적 모니터링
- [ ] 주간 에러 리포트 확인
- [ ] 사용자 행동 분석
- [ ] 성능 추이 확인

---

## 10. 개선 계획

### 단기 (1개월)
- [ ] 발견된 버그 수정
- [ ] 성능 최적화
- [ ] UX 개선

### 중기 (3개월)
- [ ] 새로운 기능 추가
- [ ] 코드 리팩토링
- [ ] 테스트 커버리지 향상

### 장기 (6개월+)
- [ ] 아키텍처 개선
- [ ] 기술 스택 업그레이드
- [ ] 확장성 개선

---

## ✨ 최종 완료!

모든 체크리스트를 통과했다면 **배포 준비 완료**입니다! 🎉

```bash
# 최종 커밋
git add .
git commit -m "chore: 전체 테스트 완료 및 배포 준비"
git push origin main

# 배포
# Vercel/Netlify 등으로 배포
```

---

**MuseYou 개발 모토:**

> "문화로 연결되는 사람들을 위한,
> 완성도 높은 서비스를 만든다"
>
> **품질은 타협하지 않는다!**

---

**작성일:** 2025-11-25  
**버전:** 1.0
