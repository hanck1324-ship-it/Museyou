# Error Boundary - ê¸°ëŠ¥ ëª…ì„¸

## Props ì¸í„°í˜ì´ìŠ¤

```typescript
interface Props {
  children: ReactNode;
  fallback?: ReactNode;  // ì»¤ìŠ¤í…€ Fallback UI
  onError?: (error: Error, errorInfo: ErrorInfo) => void;  // ì—ëŸ¬ ì½œë°±
}

interface State {
  hasError: boolean;
  error: Error | null;
  errorInfo: ErrorInfo | null;
}
```

## í˜„ì¬ êµ¬í˜„ ìƒíƒœ âœ…

### 1. ì—ëŸ¬ ê°ì§€
- `getDerivedStateFromError`ë¡œ ì—ëŸ¬ ìƒíƒœ ì„¤ì •
- `componentDidCatch`ë¡œ ì—ëŸ¬ ì •ë³´ ìˆ˜ì§‘

### 2. Fallback UI
- ê¸°ë³¸ Fallback UI í‘œì‹œ
- ì»¤ìŠ¤í…€ Fallback ì§€ì› (`fallback` prop)

### 3. ì—ëŸ¬ ì •ë³´ í‘œì‹œ
- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
- ê°œë°œ í™˜ê²½ì—ì„œ Stack trace í‘œì‹œ
- `ErrorInfo.componentStack` í‘œì‹œ

### 4. ì•¡ì…˜ ë²„íŠ¼
- "ë‹¤ì‹œ ì‹œë„" ë²„íŠ¼: ì—ëŸ¬ ìƒíƒœ ì´ˆê¸°í™”
- "í™ˆìœ¼ë¡œ" ë²„íŠ¼: í™ˆìœ¼ë¡œ ì´ë™

### 5. ì—ëŸ¬ ì½œë°±
- `onError` propìœ¼ë¡œ ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬ í˜¸ì¶œ

## ê°œì„ ì´ í•„ìš”í•œ ê¸°ëŠ¥ ğŸ”§

### 1. ì—ëŸ¬ ë¦¬í¬íŒ… ì„œë¹„ìŠ¤ ì—°ë™ â­
**í˜„ì¬:** TODO ì£¼ì„ë§Œ  
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
// Sentry ì—°ë™
import * as Sentry from '@sentry/react';

componentDidCatch(error: Error, errorInfo: ErrorInfo) {
  // ... ê¸°ì¡´ ì½”ë“œ

  // Sentryì— ì—ëŸ¬ ì „ì†¡
  if (import.meta.env.PROD) {
    Sentry.captureException(error, {
      contexts: {
        react: {
          componentStack: errorInfo.componentStack,
        },
      },
    });
  }
}

// LogRocket ì—°ë™ (ì„ íƒ)
if (import.meta.env.PROD && window.LogRocket) {
  window.LogRocket.captureException(error, {
    extra: {
      componentStack: errorInfo.componentStack,
    },
  });
}
```

### 2. ì—ëŸ¬ ë¶„ë¥˜ ë° ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
const getErrorMessage = (error: Error): string => {
  // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬
  if (error.message.includes('network') || error.message.includes('fetch')) {
    return 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
  }

  // ì¸ì¦ ì—ëŸ¬
  if (error.message.includes('auth') || error.message.includes('login')) {
    return 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';
  }

  // ê¶Œí•œ ì—ëŸ¬
  if (error.message.includes('permission') || error.message.includes('forbidden')) {
    return 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.';
  }

  // ê¸°ë³¸ ì—ëŸ¬ ë©”ì‹œì§€
  return error.message || 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
};

// Fallback UIì—ì„œ ì‚¬ìš©
<p className="text-sm text-red-800 font-medium mb-2">
  {getErrorMessage(this.state.error!)}
</p>
```

### 3. ì—ëŸ¬ ë³µêµ¬ ì „ëµ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface Props {
  // ...
  recoveryStrategy?: 'retry' | 'reload' | 'fallback';
  maxRetries?: number;
}

const [retryCount, setRetryCount] = useState(0);

handleReset = () => {
  if (retryCount < (maxRetries || 3)) {
    setRetryCount(retryCount + 1);
    this.setState({
      hasError: false,
      error: null,
      errorInfo: null,
    });
  } else {
    // ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    window.location.reload();
  }
};
```

### 4. ì—ëŸ¬ ë°œìƒ ìœ„ì¹˜ ì¶”ì  â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
const getErrorLocation = (errorInfo: ErrorInfo): string => {
  const stack = errorInfo.componentStack;
  const match = stack.match(/at\s+(.+?)\s+\((.+?):(\d+):(\d+)\)/);
  
  if (match) {
    return `${match[1]} (${match[2]}:${match[3]})`;
  }
  
  return 'ì•Œ ìˆ˜ ì—†ëŠ” ìœ„ì¹˜';
};

// Error Message Boxì— í‘œì‹œ
<div className="text-xs text-red-600 mt-2">
  ë°œìƒ ìœ„ì¹˜: {getErrorLocation(this.state.errorInfo!)}
</div>
```

### 5. ë¶€ë¶„ì  ì—ëŸ¬ ë³µêµ¬
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
// íŠ¹ì • ì»´í¬ë„ŒíŠ¸ë§Œ ì—ëŸ¬ ë³µêµ¬
interface Props {
  // ...
  onErrorFallback?: (error: Error) => ReactNode;
}

// ì‚¬ìš© ì˜ˆì‹œ
<ErrorBoundary
  onErrorFallback={(error) => {
    if (error.message.includes('PerformanceCard')) {
      return <PerformanceCardSkeleton />;
    }
    return null;
  }}
>
  <PerformanceCard />
</ErrorBoundary>
```

### 6. ì—ëŸ¬ ë¡œê¹… ê°•í™”
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
componentDidCatch(error: Error, errorInfo: ErrorInfo) {
  // ... ê¸°ì¡´ ì½”ë“œ

  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì—ëŸ¬ ì €ì¥ (ìµœê·¼ 10ê°œ)
  const errorLogs = getFromStorage<Array<{
    error: string;
    stack: string;
    componentStack: string;
    timestamp: string;
  }>>(STORAGE_KEYS.ERROR_LOGS, []);

  errorLogs.unshift({
    error: error.message,
    stack: error.stack || '',
    componentStack: errorInfo.componentStack,
    timestamp: new Date().toISOString(),
  });

  // ìµœê·¼ 10ê°œë§Œ ìœ ì§€
  if (errorLogs.length > 10) {
    errorLogs.pop();
  }

  setToStorage(STORAGE_KEYS.ERROR_LOGS, errorLogs);
}
```

## API ì—°ë™ ê³„íš

### ì—ëŸ¬ ë¦¬í¬íŒ… ì„œë¹„ìŠ¤
- **Sentry**: í”„ë¡œë•ì…˜ ì—ëŸ¬ ì¶”ì 
- **LogRocket**: ì„¸ì…˜ ì¬ìƒ ë° ì—ëŸ¬ ì¶”ì 
- **Firebase Crashlytics**: í¬ë˜ì‹œ ë¦¬í¬íŒ…

### ì—ëŸ¬ ë¡œê¹… API (ì„ íƒ)
```typescript
// lib/api/errors.ts
export const errorApi = {
  async logError(error: {
    message: string;
    stack?: string;
    componentStack?: string;
    userAgent?: string;
    url?: string;
  }) {
    if (USE_MOCK_MODE) {
      // Mock: LocalStorageì— ì €ì¥
      return { success: true };
    }

    return await apiCall('/errors/log', {
      method: 'POST',
      body: JSON.stringify(error),
    });
  },
};
```

## í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- Props ì „ë‹¬ í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ ìƒíƒœ ì„¤ì • í…ŒìŠ¤íŠ¸
- Fallback UI ë Œë”ë§ í…ŒìŠ¤íŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ ë°œìƒ ì‹œ Fallback UI í‘œì‹œ í…ŒìŠ¤íŠ¸
- "ë‹¤ì‹œ ì‹œë„" ë²„íŠ¼ ë™ì‘ í…ŒìŠ¤íŠ¸
- "í™ˆìœ¼ë¡œ" ë²„íŠ¼ ë™ì‘ í…ŒìŠ¤íŠ¸

### E2E í…ŒìŠ¤íŠ¸
- ì‹¤ì œ ì—ëŸ¬ ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ ë³µêµ¬ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

## ì ‘ê·¼ì„± (a11y)

### ARIA ë ˆì´ë¸”
```tsx
<div
  role="alert"
  aria-live="assertive"
  aria-label="ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
>
  {/* Error UI */}
</div>

<Button
  aria-label="ì—ëŸ¬ ìƒíƒœ ì´ˆê¸°í™” ë° ë‹¤ì‹œ ì‹œë„"
  onClick={this.handleReset}
>
  <RefreshCw />
  ë‹¤ì‹œ ì‹œë„
</Button>
```

### í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
- Tabìœ¼ë¡œ ë²„íŠ¼ ì´ë™
- Enter/Spaceë¡œ ë²„íŠ¼ í™œì„±í™”

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ì—ëŸ¬ ì •ë³´ ë…¸ì¶œ
- í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¯¼ê°í•œ ì •ë³´ ë…¸ì¶œ ìµœì†Œí™”
- Stack traceëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ í‘œì‹œ
- ì‚¬ìš©ìì—ê²ŒëŠ” ì¼ë°˜ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ë§Œ í‘œì‹œ

## ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ì´ì œì´ì…˜
- Error BoundaryëŠ” Class Componentì´ë¯€ë¡œ ë¶ˆí•„ìš”

### ì—ëŸ¬ ë¦¬í¬íŒ… ìµœì í™”
- Throttling: ê°™ì€ ì—ëŸ¬ëŠ” ì¼ì • ì‹œê°„ ë‚´ í•œ ë²ˆë§Œ ë¦¬í¬íŠ¸
- Sampling: ì¼ë¶€ ì—ëŸ¬ë§Œ ë¦¬í¬íŒ… (ê³¼ë„í•œ íŠ¸ë˜í”½ ë°©ì§€)
