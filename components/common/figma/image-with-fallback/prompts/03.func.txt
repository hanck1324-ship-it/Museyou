# Image With Fallback - ê¸°ëŠ¥ ëª…ì„¸

## Props ì¸í„°í˜ì´ìŠ¤

```typescript
interface ImageWithFallbackProps extends React.ImgHTMLAttributes<HTMLImageElement> {
  src?: string;
  alt?: string;
  className?: string;
  style?: React.CSSProperties;
  // ... ê¸°íƒ€ img ì†ì„±ë“¤
}
```

## í˜„ì¬ êµ¬í˜„ ìƒíƒœ âœ…

### 1. ì´ë¯¸ì§€ ë¡œë“œ
- ì›ë³¸ ì´ë¯¸ì§€ í‘œì‹œ (`src` prop)
- í‘œì¤€ `<img>` ìš”ì†Œ ì‚¬ìš©

### 2. Fallback ì²˜ë¦¬
- `onError` í•¸ë“¤ëŸ¬ë¡œ ì—ëŸ¬ ê°ì§€
- `didError` ìƒíƒœë¡œ Fallback UI í‘œì‹œ
- Base64 ì¸ì½”ë”©ëœ SVG Fallback ì´ë¯¸ì§€ ì‚¬ìš©

### 3. Props ì „ë‹¬
- ëª¨ë“  img ì†ì„± ì „ë‹¬ (`...rest`)
- `data-original-url`ì— ì›ë³¸ URL ì €ì¥

## ê°œì„ ì´ í•„ìš”í•œ ê¸°ëŠ¥ ğŸ”§

### 1. ì»¤ìŠ¤í…€ Fallback ì´ë¯¸ì§€ â­
**í˜„ì¬:** ê³ ì •ëœ SVG Fallback  
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface ImageWithFallbackProps {
  // ...
  fallbackSrc?: string;  // ì»¤ìŠ¤í…€ Fallback ì´ë¯¸ì§€ URL
  fallbackComponent?: ReactNode;  // ì»¤ìŠ¤í…€ Fallback ì»´í¬ë„ŒíŠ¸
}

return didError ? (
  fallbackComponent || (
    <div className={className} style={style}>
      {fallbackSrc ? (
        <img src={fallbackSrc} alt={alt || 'Fallback image'} {...rest} />
      ) : (
        // ê¸°ë³¸ Fallback SVG
      )}
    </div>
  )
) : (
  <img src={src} alt={alt} className={className} style={style} {...rest} onError={handleError} />
);
```

### 2. ë¡œë”© ìƒíƒœ í‘œì‹œ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
const [isLoading, setIsLoading] = useState(true);

useEffect(() => {
  if (src) {
    setIsLoading(true);
    const img = new Image();
    img.onload = () => setIsLoading(false);
    img.onerror = () => {
      setIsLoading(false);
      setDidError(true);
    };
    img.src = src;
  }
}, [src]);

return (
  <div className={className} style={style}>
    {isLoading && (
      <div className="absolute inset-0 flex items-center justify-center bg-gray-100">
        <Loader2 className="size-6 animate-spin text-gray-400" />
      </div>
    )}
    {/* ì´ë¯¸ì§€ */}
  </div>
);
```

### 3. Lazy Loading â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
import { useEffect, useRef } from 'react';

const imgRef = useRef<HTMLImageElement>(null);
const [shouldLoad, setShouldLoad] = useState(false);

useEffect(() => {
  if (!imgRef.current) return;

  const observer = new IntersectionObserver(
    (entries) => {
      if (entries[0].isIntersecting) {
        setShouldLoad(true);
        observer.disconnect();
      }
    },
    { rootMargin: '50px' }
  );

  observer.observe(imgRef.current);
  return () => observer.disconnect();
}, []);

<img
  ref={imgRef}
  src={shouldLoad ? src : undefined}
  data-src={src}
  loading="lazy"
  // ...
/>
```

### 4. ì´ë¯¸ì§€ ìµœì í™” (WebP, Responsive)
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface ImageWithFallbackProps {
  // ...
  srcSet?: string;  // Responsive images
  sizes?: string;
  format?: 'webp' | 'jpg' | 'png';  // í¬ë§· ìë™ ë³€í™˜ (ì„œë²„ ì¸¡)
}

<picture>
  <source srcSet={webpSrc} type="image/webp" />
  <source srcSet={src} type="image/jpeg" />
  <img src={src} alt={alt} {...rest} onError={handleError} />
</picture>
```

### 5. ì¬ì‹œë„ ê¸°ëŠ¥
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
const [retryCount, setRetryCount] = useState(0);
const MAX_RETRIES = 3;

const handleError = () => {
  if (retryCount < MAX_RETRIES) {
    setRetryCount(retryCount + 1);
    // ì¬ì‹œë„ (ì¼ì • ì‹œê°„ í›„)
    setTimeout(() => {
      setDidError(false);
    }, 1000 * retryCount);
  } else {
    setDidError(true);
  }
};
```

### 6. ì´ë¯¸ì§€ í”Œë ˆì´ìŠ¤í™€ë” (Blur-up)
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface ImageWithFallbackProps {
  // ...
  placeholder?: string;  // Blur ì´ë¯¸ì§€ URL (base64 ë˜ëŠ” ì €í•´ìƒë„ ì´ë¯¸ì§€)
}

const [imageLoaded, setImageLoaded] = useState(false);

return (
  <div className={className} style={style} {...rest}>
    {placeholder && !imageLoaded && (
      <img
        src={placeholder}
        alt=""
        className="absolute inset-0 w-full h-full object-cover blur-sm"
        aria-hidden="true"
      />
    )}
    <img
      src={src}
      alt={alt}
      onLoad={() => setImageLoaded(true)}
      onError={handleError}
      className={imageLoaded ? 'opacity-100' : 'opacity-0'}
      style={{ transition: 'opacity 0.3s' }}
    />
  </div>
);
```

## ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ì´ì œì´ì…˜
```typescript
export const ImageWithFallback = React.memo(
  ImageWithFallbackComponent,
  (prevProps, nextProps) => {
    return prevProps.src === nextProps.src;
  }
);
```

### ì´ë¯¸ì§€ ìµœì í™”
- WebP í¬ë§· ì§€ì›
- Responsive images (srcset)
- Lazy loading (Intersection Observer)
- ì´ë¯¸ì§€ ì••ì¶•

## í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- Props ì „ë‹¬ í…ŒìŠ¤íŠ¸
- ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ í…ŒìŠ¤íŠ¸
- ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸
- Fallback í‘œì‹œ í…ŒìŠ¤íŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- Lazy loading í…ŒìŠ¤íŠ¸
- ì¬ì‹œë„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### E2E í…ŒìŠ¤íŠ¸
- ì‹¤ì œ ì´ë¯¸ì§€ ë¡œë“œ í”Œë¡œìš°
- Fallback ì´ë¯¸ì§€ í‘œì‹œ í”Œë¡œìš°

## ì ‘ê·¼ì„± (a11y)

### ARIA ë ˆì´ë¸”
```tsx
<img
  alt={alt || 'ì´ë¯¸ì§€'}
  role="img"
  aria-label={alt}
  // ...
/>
```

### Fallback
```tsx
<div
  role="img"
  aria-label={alt || 'ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'}
>
  {/* Fallback content */}
</div>
```
