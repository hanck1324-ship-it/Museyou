# Date Proposal - ê¸°ëŠ¥ ëª…ì„¸

## Props ì¸í„°í˜ì´ìŠ¤

```typescript
interface DateProposalProps {
  performance: Performance | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit?: (proposal: DateProposalData) => void;  // ì¶”í›„ ì¶”ê°€
}

interface DateProposalData {
  performanceId: string;
  message: string;
  proposedDate?: string;  // ì¶”í›„ ì¶”ê°€
  meetingPlace?: string;  // ì¶”í›„ ì¶”ê°€
}
```

## í˜„ì¬ êµ¬í˜„ ìƒíƒœ âœ…

### 1. Dialog í‘œì‹œ
- Dialog ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- ê³µì—° ì •ë³´ í‘œì‹œ
- ì œì•ˆ ë©”ì‹œì§€ ì…ë ¥ í¼

### 2. Form ì²˜ë¦¬
- ë©”ì‹œì§€ ì…ë ¥ ê²€ì¦
- ì œì¶œ ì‹œ alert í‘œì‹œ (ì‹¤ì œ ì €ì¥ X)

### 3. ì•ˆì „ ì•ˆë‚´
- ì•ˆì „í•œ ë§Œë‚¨ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ

## ê°œì„ ì´ í•„ìš”í•œ ê¸°ëŠ¥ ğŸ”§

### 1. API ì—°ë™ â­
**í˜„ì¬:** alert í‘œì‹œë§Œ  
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
// lib/api/dateProposals.ts
export const dateProposalApi = {
  async create(proposalData: {
    performanceId: string;
    message: string;
    proposedDate?: string;
    meetingPlace?: string;
  }) {
    if (USE_MOCK_MODE) {
      const currentUser = getFromStorage(STORAGE_KEYS.CURRENT_USER, null);
      if (!currentUser) {
        throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      }

      const proposals = getFromStorage<DateProposal[]>(STORAGE_KEYS.DATE_PROPOSALS, []);
      const newProposal = {
        id: `proposal_${Date.now()}`,
        ...proposalData,
        userId: currentUser.id,
        userName: currentUser.name,
        createdAt: new Date().toISOString(),
        responses: [],
      };
      
      proposals.push(newProposal);
      setToStorage(STORAGE_KEYS.DATE_PROPOSALS, proposals);
      return { proposal: newProposal };
    }

    return await apiCall('/date-proposals', {
      method: 'POST',
      body: JSON.stringify(proposalData),
    }, true);
  },

  async getByPerformanceId(performanceId: string) {
    if (USE_MOCK_MODE) {
      const proposals = getFromStorage<DateProposal[]>(STORAGE_KEYS.DATE_PROPOSALS, []);
      return { proposals: proposals.filter(p => p.performanceId === performanceId) };
    }
    return await apiCall(`/date-proposals/performance/${performanceId}`);
  },
};
```

### 2. ì œì•ˆ ë‚ ì§œ ì„ íƒ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface DateProposalProps {
  // ...
  proposedDate?: string;
  onDateChange?: (date: string) => void;
}

// ë‚ ì§œ ì„ íƒ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
<div className="space-y-2">
  <Label>ì œì•ˆ ë‚ ì§œ</Label>
  <Calendar
    mode="single"
    selected={proposedDate ? new Date(proposedDate) : undefined}
    onSelect={(date) => onDateChange?.(date?.toISOString() || '')}
  />
</div>
```

### 3. ë§Œë‚¨ ì¥ì†Œ ì œì•ˆ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface DateProposalProps {
  // ...
  meetingPlace?: string;
  onMeetingPlaceChange?: (place: string) => void;
}

// ë§Œë‚¨ ì¥ì†Œ ì…ë ¥ ì¶”ê°€
<div className="space-y-2">
  <Label>ë§Œë‚¨ ì¥ì†Œ ì œì•ˆ (ì„ íƒ)</Label>
  <Input
    placeholder="ì˜ˆ) ê³µì—°ì¥ ì• ë§¤ì "
    value={meetingPlace}
    onChange={(e) => onMeetingPlaceChange?.(e.target.value)}
  />
</div>
```

### 4. ì‘ë‹µ ëª©ë¡ í‘œì‹œ
**í•„ìš”í•œ ê¸°ëŠ¥:**
- ì œì•ˆì— ëŒ€í•œ ì‘ë‹µ ëª©ë¡ í‘œì‹œ
- ì‘ë‹µ ë²„íŠ¼ í´ë¦­ â†’ ì±„íŒ… ë˜ëŠ” ë©”ì‹œì§€ ì „ì†¡

### 5. ì œì•ˆ ìˆ˜ì •/ì‚­ì œ
**í•„ìš”í•œ ê¸°ëŠ¥:**
- ë³¸ì¸ì´ ì‘ì„±í•œ ì œì•ˆë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
- ìˆ˜ì • ë²„íŠ¼ â†’ í¼ì— ê¸°ì¡´ ë‚´ìš© ë¡œë“œ
- ì‚­ì œ ë²„íŠ¼ â†’ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸

### 6. ì•Œë¦¼ ê¸°ëŠ¥
**í•„ìš”í•œ ê¸°ëŠ¥:**
- ì œì•ˆì— ì‘ë‹µì´ ì˜¬ ë•Œ ì•Œë¦¼
- ê³µì—° ì¼ì • ì „ ë¦¬ë§ˆì¸ë” ì•Œë¦¼

## API ì—°ë™ ê³„íš

### Supabase í…Œì´ë¸” ì„¤ê³„
```sql
CREATE TABLE date_proposals (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id),
  performance_id UUID REFERENCES performances(id),
  message TEXT NOT NULL,
  proposed_date DATE,
  meeting_place TEXT,
  status TEXT DEFAULT 'active', -- active, accepted, cancelled
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE date_proposal_responses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  proposal_id UUID REFERENCES date_proposals(id),
  user_id UUID REFERENCES users(id),
  message TEXT NOT NULL,
  status TEXT DEFAULT 'pending', -- pending, accepted, declined
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### API ì—”ë“œí¬ì¸íŠ¸
- `POST /date-proposals` - ì œì•ˆ ì‘ì„±
- `GET /date-proposals/performance/:performanceId` - ê³µì—°ë³„ ì œì•ˆ ëª©ë¡
- `GET /date-proposals/me` - ë‚´ê°€ ì‘ì„±í•œ ì œì•ˆ ëª©ë¡
- `PUT /date-proposals/:id` - ì œì•ˆ ìˆ˜ì •
- `DELETE /date-proposals/:id` - ì œì•ˆ ì‚­ì œ
- `POST /date-proposals/:id/responses` - ì‘ë‹µ ì‘ì„±
- `PUT /date-proposals/:id/responses/:responseId` - ì‘ë‹µ ìƒíƒœ ë³€ê²½

## í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- Props ì „ë‹¬ í…ŒìŠ¤íŠ¸
- Form ìœ íš¨ì„± ê²€ì‚¬ í…ŒìŠ¤íŠ¸
- ë©”ì‹œì§€ ì…ë ¥ í…ŒìŠ¤íŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
- ì œì•ˆ ì‘ì„± â†’ ì €ì¥ í”Œë¡œìš°
- ë‚ ì§œ ì„ íƒ í…ŒìŠ¤íŠ¸

### E2E í…ŒìŠ¤íŠ¸
- ì œì•ˆ ì‘ì„± ì „ì²´ í”Œë¡œìš°
- ì œì•ˆ ìˆ˜ì •/ì‚­ì œ í”Œë¡œìš°

## ì ‘ê·¼ì„± (a11y)

### ARIA ë ˆì´ë¸”
```tsx
<Dialog
  aria-labelledby="date-proposal-title"
  aria-describedby="date-proposal-description"
>
  <DialogTitle id="date-proposal-title">ë°ì´íŠ¸ ì œì•ˆí•˜ê¸°</DialogTitle>
  <DialogDescription id="date-proposal-description">
    ì´ ê³µì—°ì„ í•¨ê»˜ ë³¼ íŒŒíŠ¸ë„ˆë¥¼ ì°¾ì•„ë³´ì„¸ìš”
  </DialogDescription>
</Dialog>

<Textarea
  aria-label="ì œì•ˆ ë©”ì‹œì§€"
  aria-describedby="message-helper"
/>
```

### í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
- Tabìœ¼ë¡œ ì…ë ¥ í•„ë“œ ì´ë™
- Enter/Spaceë¡œ ë²„íŠ¼ í™œì„±í™”
- Escapeë¡œ ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ì…ë ¥ ê²€ì¦
- ë©”ì‹œì§€ ê¸¸ì´ ì œí•œ (ìµœëŒ€ 500ì)
- ê¸ˆì§€ ë‹¨ì–´ í•„í„°ë§
- XSS ë°©ì§€

### ê¶Œí•œ í™•ì¸
- ë¡œê·¸ì¸ í•„ìˆ˜
- ë³¸ì¸ ì œì•ˆë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥

## ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ì´ì œì´ì…˜
```typescript
const DateProposal = React.memo(
  DateProposalComponent,
  (prevProps, nextProps) => {
    return (
      prevProps.performance?.id === nextProps.performance?.id &&
      prevProps.open === nextProps.open
    );
  }
);
```
