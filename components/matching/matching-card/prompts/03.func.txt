# Matching Card - 기능 명세

## Props 인터페이스

### MatchingCard (기본)
```typescript
interface MatchingCardProps {
  user: UserMatch;
  onLike: (userId: string) => void;
  onPass: (userId: string) => void;
  onMessage: (userId: string) => void;
  onViewProfile: (user: UserMatch) => void;
}
```

### SwipeableMatchingCard (스와이프 가능)
```typescript
interface SwipeableMatchingCardProps {
  user: UserMatch;
  onLike: (userId: string) => void;
  onPass: (userId: string) => void;
  onMessage: (userId: string) => void;
  onViewProfile: (user: UserMatch) => void;
  index: number;        // 스택 내 인덱스
  total: number;        // 전체 카드 수
}
```

### MatchingCardStack (카드 스택)
```typescript
interface MatchingCardStackProps {
  users: UserMatch[];
  onLike: (userId: string) => void;
  onPass: (userId: string) => void;
  onMessage: (userId: string) => void;
  onViewProfile: (user: UserMatch) => void;
  isLoading?: boolean;
}
```

## 현재 구현 상태 ✅

### 1. SwipeableMatchingCard 컴포넌트 ✅
**구현 완료 (2025-01-27)**

**주요 기능:**
- ✅ Framer Motion 기반 드래그/스와이프 애니메이션
- ✅ 오른쪽 스와이프 = 좋아요 (Like)
- ✅ 왼쪽 스와이프 = 패스 (Pass)
- ✅ 스와이프 임계값: 100px 또는 속도 500px/s
- ✅ 스와이프 시 회전 효과 (최대 ±30도)
- ✅ 좋아요/패스 오버레이 표시
- ✅ 버튼 클릭으로도 좋아요/패스 가능
- ✅ 성별별 색상 테마 (남성: emerald, 여성: pink)
- ✅ 다크모드 지원

**기술 스택:**
- `motion/react` (Framer Motion)
- `useMotionValue`, `useTransform` for 애니메이션
- `PanInfo` for 드래그 제스처

**애니메이션:**
```typescript
const x = useMotionValue(0);
const rotate = useTransform(x, [-300, 300], [-30, 30]);
const opacity = useTransform(x, [-300, -100, 0, 100, 300], [0, 1, 1, 1, 0]);
const likeOpacity = useTransform(x, [0, SWIPE_THRESHOLD], [0, 1]);
const passOpacity = useTransform(x, [-SWIPE_THRESHOLD, 0], [1, 0]);
```

### 2. MatchingCardStack 컴포넌트 ✅
**구현 완료 (2025-01-27)**

**주요 기능:**
- ✅ 최대 3개 카드만 동시에 표시 (성능 최적화)
- ✅ 카드 제거 시 다음 카드 자동 로드
- ✅ AnimatePresence로 부드러운 전환
- ✅ 스택 효과 (뒤에 있는 카드들 scale/y 조정)
- ✅ 로딩 스켈레톤 표시
- ✅ 빈 상태 처리

**최적화:**
- `MAX_VISIBLE_CARDS = 3` - 동시 렌더링 카드 수 제한
- `zIndex` 관리로 스택 효과
- `pointerEvents` 제어로 상호작용 최적화

### 3. App.tsx 통합 ✅
**구현 완료 (2025-01-27)**

- ✅ `MatchingCardStack` 컴포넌트 사용
- ✅ 기존 `MatchingCard` 그리드 레이아웃 대신 스택 방식 적용

## API 연동 계획

### Supabase 테이블 설계 (참고)
```sql
CREATE TABLE user_matches (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id),
  matched_user_id UUID REFERENCES users(id),
  match_score NUMERIC(5, 2),  -- 매칭률 (0-100)
  status TEXT DEFAULT 'pending',  -- pending, liked, passed, matched
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, matched_user_id)
);

CREATE TABLE user_interests (
  user_id UUID REFERENCES users(id),
  interest TEXT,
  PRIMARY KEY (user_id, interest)
);

CREATE TABLE user_want_to_see (
  user_id UUID REFERENCES users(id),
  performance_id UUID REFERENCES performances(id),
  date DATE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  PRIMARY KEY (user_id, performance_id)
);
```

### API 엔드포인트
- `GET /api/matches` - 매칭 후보 목록 조회
- `POST /api/matches/:userId/like` - 좋아요 처리
- `POST /api/matches/:userId/pass` - 패스 처리
- `GET /api/matches/:userId/profile` - 프로필 상세 조회

## 상태 관리

### 현재 구현
- 로컬 상태: `useState`로 카드 스택 관리
- 전역 상태: 필요 시 `zustand` 스토어 추가 가능

### 추천 상태 관리 구조
```typescript
interface MatchingStore {
  users: UserMatch[];
  currentIndex: number;
  likedUsers: string[];
  passedUsers: string[];
  isLoading: boolean;
  
  // Actions
  fetchMatches: () => Promise<void>;
  likeUser: (userId: string) => Promise<void>;
  passUser: (userId: string) => Promise<void>;
  loadMore: () => Promise<void>;
}
```

## 테스트 계획

### 단위 테스트
- ✅ SwipeableMatchingCard 렌더링 테스트
- ✅ 드래그 제스처 테스트
- ✅ 좋아요/패스 콜백 테스트
- ✅ MatchingCardStack 카드 관리 테스트

### 통합 테스트
- ✅ 스와이프 → 좋아요 플로우
- ✅ 스와이프 → 패스 플로우
- ✅ 버튼 클릭 → 좋아요/패스 플로우
- ✅ 카드 스택 순환 테스트

### E2E 테스트
- ✅ 매칭 페이지 → 스와이프 → 좋아요 플로우
- ✅ 매칭 페이지 → 프로필 보기 플로우
- ✅ 매칭 페이지 → 메시지 보내기 플로우

## 성능 최적화

### 현재 적용된 최적화 ✅
- ✅ 최대 3개 카드만 동시 렌더링
- ✅ `AnimatePresence`로 불필요한 리렌더링 방지
- ✅ `pointerEvents` 제어로 상호작용 최적화
- ✅ 이미지 lazy loading (ImageWithFallback)

### 추가 최적화 제안
- [ ] 가상화 (react-window) - 많은 카드 처리 시
- [ ] 이미지 프리로딩 - 다음 카드 이미지 미리 로드
- [ ] 메모이제이션 - React.memo 적용

## 접근성 (a11y)

### 현재 구현
- ✅ 버튼 역할 명확화
- ✅ 키보드 네비게이션 (기본)

### 개선 제안
- [ ] ARIA 라벨 추가
- [ ] 스크린 리더 지원
- [ ] 키보드 단축키 (좌우 화살표로 스와이프)

## 향후 개선 사항

### 1. 매칭 알고리즘 개선
- [ ] 선호도 기반 매칭 점수 계산
- [ ] 위치 기반 필터링
- [ ] 관심사 유사도 계산

### 2. 애니메이션 개선
- [ ] 파티클 이펙트 (좋아요 시)
- [ ] 스프링 애니메이션 튜닝
- [ ] 성능 모니터링

### 3. 사용자 경험 개선
- [ ] 되돌리기 기능 (Undo)
- [ ] 슈퍼 좋아요 (Super Like)
- [ ] 매칭 성공 알림

### 4. 실시간 업데이트
- [ ] Supabase Realtime으로 새 매칭 후보 알림
- [ ] 상호 좋아요 시 매칭 성공 알림
