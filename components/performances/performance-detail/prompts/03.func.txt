# Performance Detail - ê¸°ëŠ¥ ëª…ì„¸

## Props ì¸í„°í˜ì´ìŠ¤

```typescript
interface PerformanceDetailProps {
  performance: Performance | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onBook?: (performance: Performance) => void;  // ì¶”í›„ ì¶”ê°€
  onShare?: (performance: Performance) => void;  // ì¶”í›„ ì¶”ê°€
}
```

## í˜„ì¬ êµ¬í˜„ ìƒíƒœ âœ…

### 1. Dialog í‘œì‹œ
- Dialog ì»´í¬ë„ŒíŠ¸ë¡œ ìƒì„¸ ì •ë³´ í‘œì‹œ
- ê³µì—° ì´ë¯¸ì§€, ì •ë³´, ë¦¬ë·° í‘œì‹œ

### 2. Tab êµ¬ì¡°
- ê³µì—°ì •ë³´ íƒ­: ì„¤ëª…, ì£¼ìµœ, ê´€ëŒë£Œ, ë‚ ì§œ/ì‹œê°„/ì¥ì†Œ
- ì¥ì†Œ/ê²½ë¡œ íƒ­: ê³µì—°ì¥ ì •ë³´, ì§€ë„, ê¸¸ì°¾ê¸°, êµí†µí¸
- ë¦¬ë·° íƒ­: ReviewSection ì»´í¬ë„ŒíŠ¸

### 3. ì§€ë„ í†µí•©
- PerformanceMap ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- Kakao Mapìœ¼ë¡œ ê³µì—°ì¥ ìœ„ì¹˜ í‘œì‹œ
- ê¸¸ì°¾ê¸° ë²„íŠ¼ (ì¹´ì¹´ì˜¤ë§µ ë§í¬)

### 4. ë¦¬ë·° ì„¹ì…˜
- ReviewSection ì»´í¬ë„ŒíŠ¸ í†µí•©
- ë¦¬ë·° ì‘ì„± ë° í‘œì‹œ

## ê°œì„ ì´ í•„ìš”í•œ ê¸°ëŠ¥ ğŸ”§

### 1. ì˜ˆë§¤ ë²„íŠ¼ ì—°ë™ â­
**í˜„ì¬:** ë¯¸êµ¬í˜„  
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface PerformanceDetailProps {
  // ...
  onBook?: (performance: Performance) => void;
}

// ì˜ˆë§¤ ë²„íŠ¼ ì¶”ê°€
<Button
  className="w-full bg-gradient-to-r from-emerald-500 to-emerald-600"
  onClick={() => {
    if (performance.bookingUrl) {
      window.open(performance.bookingUrl, '_blank');
    } else {
      onBook?.(performance);
    }
  }}
>
  <Ticket className="size-4 mr-2" />
  ì˜ˆë§¤í•˜ê¸°
</Button>
```

### 2. ê³µìœ  ê¸°ëŠ¥ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface PerformanceDetailProps {
  // ...
  onShare?: (performance: Performance) => void;
}

const handleShare = async () => {
  const shareData = {
    title: performance.title,
    text: `${performance.title} - ${performance.category} ê³µì—°`,
    url: `${window.location.origin}/performance/${performance.id}`,
  };

  if (navigator.share && navigator.canShare(shareData)) {
    await navigator.share(shareData);
  } else {
    // í´ë¦½ë³´ë“œ ë³µì‚¬ fallback
    await navigator.clipboard.writeText(shareData.url);
    toast.success('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
  }
};

// ê³µìœ  ë²„íŠ¼ ì¶”ê°€ (Dialog Header)
<Button
  variant="ghost"
  size="icon"
  onClick={handleShare}
>
  <Share2 className="size-4" />
</Button>
```

### 3. ì¢‹ì•„ìš” ê¸°ëŠ¥ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface PerformanceDetailProps {
  // ...
  isLiked?: boolean;
  onToggleLike?: (performanceId: string) => void;
  isLoggedIn?: boolean;
}

// ì¢‹ì•„ìš” ë²„íŠ¼ ì¶”ê°€ (Dialog Header)
<Button
  variant="ghost"
  size="icon"
  onClick={() => onToggleLike?.(performance.id)}
  className={isLiked ? 'text-red-500' : ''}
>
  <Heart className={isLiked ? 'fill-current' : ''} />
</Button>
```

### 4. ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ â­
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface Performance {
  // ...
  images?: string[];  // ì—¬ëŸ¬ ì´ë¯¸ì§€ ì§€ì›
  image: string;      // ëŒ€í‘œ ì´ë¯¸ì§€
}

// Carouselë¡œ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ì¶”ê°€
<Carousel className="h-64">
  {performance.images?.map((img, idx) => (
    <CarouselItem key={idx}>
      <ImageWithFallback src={img} alt={`${performance.title} ${idx + 1}`} />
    </CarouselItem>
  )) || (
    <CarouselItem>
      <ImageWithFallback src={performance.image} alt={performance.title} />
    </CarouselItem>
  )}
</Carousel>
```

### 5. ê´€ë ¨ ê³µì—° ì¶”ì²œ
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
// Tab ì¶”ê°€: "ê´€ë ¨ ê³µì—°"
<TabsContent value="related" className="space-y-4">
  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
    {relatedPerformances.map((related) => (
      <PerformanceCard
        key={related.id}
        performance={related}
        onViewDetails={handleViewDetails}
      />
    ))}
  </div>
</TabsContent>
```

### 6. íƒ€ì„ë¼ì¸ í‘œì‹œ (ê³µì—° ì¼ì •)
**í•„ìš”í•œ ê¸°ëŠ¥:**
```typescript
interface Performance {
  // ...
  schedule?: Array<{
    date: string;
    time: string;
    availability: 'available' | 'sold-out' | 'limited';
  }>;
}

// íƒ€ì„ë¼ì¸ í‘œì‹œ
<div className="space-y-2">
  <h4>ê³µì—° ì¼ì •</h4>
  {performance.schedule?.map((schedule, idx) => (
    <div key={idx} className="flex items-center gap-3 p-3 bg-muted rounded-lg">
      <Calendar className="size-4" />
      <div className="flex-1">
        <p className="text-sm">{schedule.date} {schedule.time}</p>
      </div>
      <Badge variant={
        schedule.availability === 'available' ? 'default' :
        schedule.availability === 'sold-out' ? 'destructive' : 'secondary'
      }>
        {schedule.availability === 'available' ? 'ì˜ˆë§¤ ê°€ëŠ¥' :
         schedule.availability === 'sold-out' ? 'ë§¤ì§„' : 'ì¢Œì„ ë¶€ì¡±'}
      </Badge>
    </div>
  ))}
</div>
```

## API ì—°ë™ ê³„íš

### Supabase í…Œì´ë¸” ì„¤ê³„ (ì°¸ê³ )
```sql
CREATE TABLE performances (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  title TEXT NOT NULL,
  category TEXT,
  venue TEXT,
  district TEXT,
  date TEXT,
  time TEXT,
  price TEXT,
  image TEXT,
  images TEXT[],  -- ì—¬ëŸ¬ ì´ë¯¸ì§€ ì§€ì›
  rating NUMERIC(3, 2),
  review_count INTEGER DEFAULT 0,
  description TEXT,
  organizer TEXT,
  booking_url TEXT,  -- ì˜ˆë§¤ ë§í¬
  lat NUMERIC(10, 8),
  lng NUMERIC(11, 8),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE performance_schedules (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  performance_id UUID REFERENCES performances(id),
  date DATE NOT NULL,
  time TIME NOT NULL,
  availability TEXT DEFAULT 'available',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE related_performances (
  performance_id UUID REFERENCES performances(id),
  related_id UUID REFERENCES performances(id),
  similarity_score NUMERIC(3, 2),
  PRIMARY KEY (performance_id, related_id)
);
```

### API ì—”ë“œí¬ì¸íŠ¸
- `GET /performances/:id` - ê³µì—° ìƒì„¸ ì •ë³´
- `GET /performances/:id/schedule` - ê³µì—° ì¼ì •
- `GET /performances/:id/related` - ê´€ë ¨ ê³µì—° ëª©ë¡
- `POST /performances/:id/share` - ê³µìœ  ì¹´ìš´íŠ¸ ì¦ê°€

## í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ âœ…
**êµ¬í˜„ ì™„ë£Œ (2025-01-27)**

**í…ŒìŠ¤íŠ¸ íŒŒì¼:** `src/components/performances/PerformanceDetail.test.tsx`

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (6ê°œ ëª¨ë‘ í†µê³¼):**
- âœ… `performance`ê°€ nullì¼ ë•Œ ë Œë”ë§ ì•ˆ í•¨
- âœ… `open`ì´ falseì¼ ë•Œ ë Œë”ë§ ì•ˆ í•¨
- âœ… ê³µì—° ìƒì„¸ ì •ë³´ ë Œë”ë§ (ì œëª©, ì¹´í…Œê³ ë¦¬, ì§€ì—­)
- âœ… ê³µì—°ì •ë³´ íƒ­ ì½˜í…ì¸  í‘œì‹œ (ì„¤ëª…, ì£¼ìµœ, ê°€ê²©)
- âœ… íƒ­ í‘œì‹œ (ê³µì—°ì •ë³´, ì¥ì†Œ/ê²½ë¡œ, ë¦¬ë·°)
- âœ… ë¦¬ë·° íƒ­ í´ë¦­ ì‹œ ReviewSection í‘œì‹œ

**Mock ì„¤ì •:**
- `usePerformanceRating` hook
- `getVenueCoordinates` utility
- `loadKakaoMapSDK` utility
- UI ì»´í¬ë„ŒíŠ¸ë“¤ (Dialog, Tabs, Button, Badge, Skeleton)
- PerformanceMap, ReviewSection ì»´í¬ë„ŒíŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ì¢‹ì•„ìš” ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ê³µìœ  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ì˜ˆë§¤ ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸
- [ ] ì§€ë„ í‘œì‹œ í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ì¢Œí‘œ ë¡œë“œ)

### E2E í…ŒìŠ¤íŠ¸
- [ ] ìƒì„¸ë³´ê¸° â†’ ì˜ˆë§¤ í”Œë¡œìš°
- [ ] ìƒì„¸ë³´ê¸° â†’ ê³µìœ  í”Œë¡œìš°
- [ ] ìƒì„¸ë³´ê¸° â†’ ê´€ë ¨ ê³µì—° ë³´ê¸° í”Œë¡œìš°

## ì ‘ê·¼ì„± (a11y)

### ARIA ë ˆì´ë¸”
```tsx
<Dialog
  aria-labelledby="performance-detail-title"
  aria-describedby="performance-detail-description"
>
  <DialogTitle id="performance-detail-title">
    {performance.title}
  </DialogTitle>
</Dialog>

<Button
  aria-label="ì˜ˆë§¤í•˜ê¸°"
  onClick={handleBook}
>
  <Ticket />
  ì˜ˆë§¤í•˜ê¸°
</Button>
```

### í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
- Tabìœ¼ë¡œ Tab ì „í™˜
- Enter/Spaceë¡œ ë²„íŠ¼ í™œì„±í™”
- Escapeë¡œ Dialog ë‹«ê¸°

## ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ì´ì œì´ì…˜
```typescript
export const PerformanceDetail = React.memo(
  PerformanceDetailComponent,
  (prevProps, nextProps) => {
    return (
      prevProps.performance?.id === nextProps.performance?.id &&
      prevProps.open === nextProps.open
    );
  }
);
```

### ì´ë¯¸ì§€ ìµœì í™”
- ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ Lazy loading
- WebP í¬ë§· ì§€ì›
- Responsive images

## ë‹¤í¬ëª¨ë“œ ì§€ì›

### í˜„ì¬ ìƒíƒœ
- ê¸°ë³¸ ë‹¤í¬ëª¨ë“œ í´ë˜ìŠ¤ ì ìš©ë¨
- ì¶”ê°€ ê°œì„  í•„ìš”: ì¸í¬ìœˆë„ìš°, ì§€ë„ ìŠ¤íƒ€ì¼
